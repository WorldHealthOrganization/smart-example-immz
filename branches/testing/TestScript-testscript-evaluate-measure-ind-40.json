{
  "resourceType" : "TestScript",
  "id" : "testscript-evaluate-measure-ind-40",
  "text" : {
    "status" : "generated",
    "div" : "<div xmlns=\"http://www.w3.org/1999/xhtml\"><p><b>Generated Narrative: TestScript</b><a name=\"testscript-evaluate-measure-ind-40\"> </a><a name=\"hctestscript-evaluate-measure-ind-40\"> </a></p><div style=\"display: inline-block; background-color: #d9e0e7; padding: 6px; margin: 4px; border: 1px solid #8da1b4; border-radius: 5px; line-height: 60%\"><p style=\"margin-bottom: 0px\">Resource TestScript &quot;testscript-evaluate-measure-ind-40&quot; </p></div><p><b>url</b>: <code>http://smart.who.int/immunizations/TestScript/testscript-smart-immunizations-measles-ind08-d2</code></p><p><b>version</b>: 0.1.0</p><p><b>name</b>: TestScriptEvaluateIND40</p><p><b>title</b>: TestScript - Evaluate Measure - IND40</p><p><b>status</b>: draft</p><p><b>experimental</b>: true</p><p><b>date</b>: 2017-01-18</p><p><b>publisher</b>: WHO</p><p><b>contact</b>: WHO: <a href=\"http://who.int\">http://who.int</a></p><p><b>description</b>: TestScript for Measles IND 40</p><p><b>purpose</b>: Test Measles immmunization indicator 40</p><p><b>copyright</b>: © 2024+</p><blockquote><p><b>fixture</b></p><blockquote><p><b>id</b></p>patient-P123456</blockquote><p><b>autocreate</b>: true</p><p><b>autodelete</b>: false</p><p><b>resource</b>: <a href=\"Patient-P123456.html\">Patient/P123456: Patient P123456</a> &quot; PATIENT&quot;</p></blockquote><blockquote><p><b>fixture</b></p><blockquote><p><b>id</b></p>Immunization1</blockquote><p><b>autocreate</b>: true</p><p><b>autodelete</b>: false</p><p><b>resource</b>: <a href=\"Immunization-Immunization1.html\">Immunization/Immunization1: Patient P123456 - first measles immunization</a></p></blockquote><blockquote><p><b>fixture</b></p><blockquote><p><b>id</b></p>Immunization2</blockquote><p><b>autocreate</b>: true</p><p><b>autodelete</b>: false</p><p><b>resource</b>: <a href=\"Immunization-Immunization2.html\">Immunization/Immunization2: Patient P123456 - second measles immunization</a></p></blockquote><blockquote><p><b>variable</b></p><p><b>name</b>: femaleCountExpression</p><p><b>description</b>: Evaluate the returned total of females with the expected vaccine coverage</p><p><b>expression</b>: MeasureReport.group.stratifier.where(id='IMMZ.IND.08.S2').stratum.where(value.text='female').population.where(id='IMMZ.IND.08.N').count.toInteger()</p></blockquote><blockquote><p><b>variable</b></p><p><b>name</b>: cqlserverbase</p><p><b>defaultValue</b>: http://localhost:8080/fhir</p><p><b>description</b>: URL for the CQL server</p></blockquote><blockquote><p><b>variable</b></p><p><b>name</b>: expectedCount</p><p><b>defaultValue</b>: 1</p><p><b>description</b>: Expected patient count for mealles immunization indicator 40</p></blockquote><blockquote><p><b>setup</b></p><blockquote><p><b>action</b></p><h3>Operations</h3><table class=\"grid\"><tr><td style=\"display: none\">-</td><td><b>Type</b></td><td><b>Resource</b></td><td><b>Description</b></td><td><b>Accept</b></td><td><b>EncodeRequestUrl</b></td><td><b>SourceId</b></td></tr><tr><td style=\"display: none\">*</td><td>post (Details: http://hl7.org/fhir/restful-interaction code post = 'post', stated as 'null')</td><td>Patient</td><td>POST resources to server.</td><td>json</td><td>true</td><td>patient-P123456</td></tr></table><h3>Asserts</h3><table class=\"grid\"><tr><td style=\"display: none\">-</td><td><b>Description</b></td><td><b>Response</b></td><td><b>WarningOnly</b></td></tr><tr><td style=\"display: none\">*</td><td>Confirm that results were POSTed OK.</td><td>created</td><td>false</td></tr></table></blockquote><blockquote><p><b>action</b></p><h3>Operations</h3><table class=\"grid\"><tr><td style=\"display: none\">-</td><td><b>Type</b></td><td><b>Resource</b></td><td><b>Description</b></td><td><b>Accept</b></td><td><b>EncodeRequestUrl</b></td><td><b>SourceId</b></td></tr><tr><td style=\"display: none\">*</td><td>post (Details: http://hl7.org/fhir/restful-interaction code post = 'post', stated as 'null')</td><td>Immunization</td><td>POST resources to server.</td><td>json</td><td>true</td><td>Immunization1</td></tr></table><h3>Asserts</h3><table class=\"grid\"><tr><td style=\"display: none\">-</td><td><b>Description</b></td><td><b>Response</b></td><td><b>WarningOnly</b></td></tr><tr><td style=\"display: none\">*</td><td>Confirm that results was POSTed OK.</td><td>created</td><td>false</td></tr></table></blockquote><blockquote><p><b>action</b></p><h3>Operations</h3><table class=\"grid\"><tr><td style=\"display: none\">-</td><td><b>Type</b></td><td><b>Resource</b></td><td><b>Description</b></td><td><b>Accept</b></td><td><b>EncodeRequestUrl</b></td><td><b>SourceId</b></td></tr><tr><td style=\"display: none\">*</td><td>post (Details: http://hl7.org/fhir/restful-interaction code post = 'post', stated as 'null')</td><td>Immunization</td><td>POST resources to server.</td><td>json</td><td>true</td><td>Immunization2</td></tr></table><h3>Asserts</h3><table class=\"grid\"><tr><td style=\"display: none\">-</td><td><b>Description</b></td><td><b>Response</b></td><td><b>WarningOnly</b></td></tr><tr><td style=\"display: none\">*</td><td>Confirm that results was POSTed OK.</td><td>created</td><td>false</td></tr></table></blockquote></blockquote><blockquote><p><b>test</b></p><blockquote><p><b>id</b></p>01-Evaluate</blockquote><p><b>name</b>: Evaluate the measure</p><p><b>description</b>: Evaluate the measure.</p><blockquote><p><b>action</b></p><h3>Operations</h3><table class=\"grid\"><tr><td style=\"display: none\">-</td><td><b>Type</b></td><td><b>Description</b></td><td><b>Accept</b></td><td><b>ContentType</b></td><td><b>EncodeRequestUrl</b></td><td><b>ResponseId</b></td><td><b>SourceId</b></td><td><b>Url</b></td></tr><tr><td style=\"display: none\">*</td><td>evaluate (Details: http://hl7.org/fhir/restful-interaction code evaluate = 'evaluate', stated as 'null')</td><td>Send the request for the Measure evaluation.</td><td>json</td><td>json</td><td>true</td><td>PatientCreateResponse</td><td>fixture-patient-create</td><td>${cqlserverbase}/Measure/IMMZIND40/$evaluate-measure?periodStart=2000-01-01&amp;periodEnd=2024-12-31</td></tr></table><h3>Asserts</h3><table class=\"grid\"><tr><td style=\"display: none\">-</td><td><b>Description</b></td><td><b>Response</b></td><td><b>WarningOnly</b></td></tr><tr><td style=\"display: none\">*</td><td>Confirm that the returned HTTP status is 201(Created).</td><td>okay</td><td>false</td></tr></table></blockquote><blockquote><p><b>action</b></p><h3>Asserts</h3><table class=\"grid\"><tr><td style=\"display: none\">-</td><td><b>Description</b></td><td><b>Expression</b></td><td><b>WarningOnly</b></td></tr><tr><td style=\"display: none\">*</td><td>Confirm that the returned result evaluates to the expected value</td><td>${femaleCountExpression}=$#{expectedCount}</td><td>false</td></tr></table></blockquote></blockquote></div>"
  },
  "url" : "http://smart.who.int/immunizations/TestScript/testscript-smart-immunizations-measles-ind08-d2",
  "version" : "0.1.0",
  "name" : "TestScriptEvaluateIND40",
  "title" : "TestScript - Evaluate Measure - IND40",
  "status" : "draft",
  "experimental" : true,
  "date" : "2017-01-18",
  "publisher" : "WHO",
  "contact" : [{
    "name" : "WHO",
    "telecom" : [{
      "system" : "url",
      "value" : "http://who.int"
    }]
  }],
  "description" : "TestScript for Measles IND 40",
  "purpose" : "Test Measles immmunization indicator 40",
  "copyright" : "© 2024+",
  "fixture" : [{
    "id" : "patient-P123456",
    "autocreate" : true,
    "autodelete" : false,
    "resource" : {
      "reference" : "Patient/P123456",
      "display" : "Patient P123456"
    }
  },
  {
    "id" : "Immunization1",
    "autocreate" : true,
    "autodelete" : false,
    "resource" : {
      "reference" : "Immunization/Immunization1",
      "display" : "Patient P123456 - first measles immunization"
    }
  },
  {
    "id" : "Immunization2",
    "autocreate" : true,
    "autodelete" : false,
    "resource" : {
      "reference" : "Immunization/Immunization2",
      "display" : "Patient P123456 - second measles immunization"
    }
  }],
  "variable" : [{
    "name" : "femaleCountExpression",
    "description" : "Evaluate the returned total of females with the expected vaccine coverage",
    "expression" : "MeasureReport.group.stratifier.where(id='IMMZ.IND.08.S2').stratum.where(value.text='female').population.where(id='IMMZ.IND.08.N').count.toInteger()"
  },
  {
    "name" : "cqlserverbase",
    "defaultValue" : "http://localhost:8080/fhir",
    "description" : "URL for the CQL server"
  },
  {
    "name" : "expectedCount",
    "defaultValue" : "1",
    "description" : "Expected patient count for mealles immunization indicator 40"
  }],
  "setup" : {
    "action" : [{
      "operation" : {
        "type" : {
          "system" : "http://hl7.org/fhir/restful-interaction",
          "code" : "post"
        },
        "resource" : "Patient",
        "description" : "POST resources to server.",
        "accept" : "json",
        "encodeRequestUrl" : true,
        "sourceId" : "patient-P123456"
      },
      "assert" : {
        "description" : "Confirm that results were POSTed OK.",
        "response" : "created",
        "warningOnly" : false
      }
    },
    {
      "operation" : {
        "type" : {
          "system" : "http://hl7.org/fhir/restful-interaction",
          "code" : "post"
        },
        "resource" : "Immunization",
        "description" : "POST resources to server.",
        "accept" : "json",
        "encodeRequestUrl" : true,
        "sourceId" : "Immunization1"
      },
      "assert" : {
        "description" : "Confirm that results was POSTed OK.",
        "response" : "created",
        "warningOnly" : false
      }
    },
    {
      "operation" : {
        "type" : {
          "system" : "http://hl7.org/fhir/restful-interaction",
          "code" : "post"
        },
        "resource" : "Immunization",
        "description" : "POST resources to server.",
        "accept" : "json",
        "encodeRequestUrl" : true,
        "sourceId" : "Immunization2"
      },
      "assert" : {
        "description" : "Confirm that results was POSTed OK.",
        "response" : "created",
        "warningOnly" : false
      }
    }]
  },
  "test" : [{
    "id" : "01-Evaluate",
    "name" : "Evaluate the measure",
    "description" : "Evaluate the measure.",
    "action" : [{
      "operation" : {
        "type" : {
          "system" : "http://hl7.org/fhir/restful-interaction",
          "code" : "evaluate"
        },
        "description" : "Send the request for the Measure evaluation.",
        "accept" : "json",
        "contentType" : "json",
        "encodeRequestUrl" : true,
        "responseId" : "PatientCreateResponse",
        "sourceId" : "fixture-patient-create",
        "url" : "${cqlserverbase}/Measure/IMMZIND40/$evaluate-measure?periodStart=2000-01-01&periodEnd=2024-12-31"
      },
      "assert" : {
        "description" : "Confirm that the returned HTTP status is 201(Created).",
        "response" : "okay",
        "warningOnly" : false
      }
    },
    {
      "assert" : {
        "description" : "Confirm that the returned result evaluates to the expected value",
        "expression" : "${femaleCountExpression}=$#{expectedCount}",
        "warningOnly" : false
      }
    }]
  }]
}